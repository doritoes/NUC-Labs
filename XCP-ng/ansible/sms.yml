---
- name: SMS initial setup playbook
  hosts: sms
  gather_facts: False
  vars:
    system_name: sms
    system_ip: 192.168.41.20
    system_ip_masklen: 24
    system_default_gateway: 192.168.41.1
  vars_files:
    - vars.yml

  tasks:
    - name: Create FTW template
      ansible.builtin.template:
        src: sms.j2
        dest: ftw.templ
        mode: u=rw,g=r,o=r
    - name: Applying FTW template... please wait...
      command: "/usr/bin/config_system -f /home/ansible/ftw.templ"
    - name: Wait until FTW completes
      stat:
        path: /etc/.wizard_accepted
      register: file_data
      until: file_data.stat.exists
      retries: 20
      delay: 15
    - name: Waiting 15 seconds before reboot
      pause:
        seconds: 10
    - name: Reboot
      command: "shutdown -r now"
