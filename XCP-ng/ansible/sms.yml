---
- name: SMS initial setup playbook
  hosts: sms
  gather_facts: False
  vars:
    system_name: sms
  vars_files:
    - vars.yml

  tasks:
    - name: Create ftwstart script
      ansible.builtin.template:
        src: sms.j2
        dest: ftw.templ
        mode: u=rwx,g=rx,o=rx
    - name: Run FTW setup... please wait...
      command: "config_system -f /home/ansible/ftw.temp"
    - name: Wait until FTW completes
      stat:
        path: /etc/.wizard_accepted
      register: file_data
      until: file_data.stat.exists
      retries: 20
      delay: 15
    - name: Waiting 15 seconds before reboot
      pause:
        seconds: 10
    - name: Reboot
      command: "shutdown -r now"
